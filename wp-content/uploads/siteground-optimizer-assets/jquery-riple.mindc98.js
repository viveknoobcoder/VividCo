/*!
 * jQuery Ripples plugin v0.5.3 / https://github.com/sirxemic/jquery.ripples
 * MIT License
 * @author sirxemic / https://sirxemic.com/
 */(function(a){typeof define=='function'&&define.amd?define(['jquery'],a):typeof exports=='object'?a(require('jquery')):a(jQuery)})(function(b){'use strict';var h=b(window),a,d,m,c,o;function e(a){return a[a.length-1]=='%'}function l(){var e=document.createElement('canvas'),b,c,g,i,h,d;if(a=e.getContext('webgl')||e.getContext('experimental-webgl'),!a)return null;if(b={},['OES_texture_float','OES_texture_half_float','OES_texture_float_linear','OES_texture_half_float_linear'].forEach(function(c){var d=a.getExtension(c);d&&(b[c]=d)}),!b.OES_texture_float)return null;c=[];function f(f,g){var a='OES_texture_'+f,c=a+'_linear',d=c in b,e=[a];return d&&e.push(c),{type:g,linearSupport:d,extensions:e}}c.push(f('float',a.FLOAT)),b.OES_texture_half_float&&c.push(f('half_float',b.OES_texture_half_float.HALF_FLOAT_OES)),g=a.createTexture(),i=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,i),a.bindTexture(a.TEXTURE_2D,g),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),h=null;for(d=0;d<c.length;d++)if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,32,32,0,a.RGBA,c[d].type,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,g,0),a.checkFramebufferStatus(a.FRAMEBUFFER)===a.FRAMEBUFFER_COMPLETE){h=c[d];break}return h}function j(a,b){try{return new ImageData(a,b)}catch(d){var c=document.createElement('canvas');return c.getContext('2d').createImageData(a,b)}}function n(a){var b=a.split(' ');if(b.length===1)switch(a){case'center':return['50%','50%'];case'top':return['50%','0'];case'bottom':return['50%','100%'];case'left':return['0','50%'];case'right':return['100%','50%'];default:return[a,'50%']}else return b.map(function(b){switch(a){case'center':return'50%';case'top':case'left':return'0';case'right':case'bottom':return'100%';default:return b}})}function g(h,e,j){var b,d,c,i,f;function g(c,d){var b=a.createShader(c);if(a.shaderSource(b,d),a.compileShader(b),!a.getShaderParameter(b,a.COMPILE_STATUS))throw new Error('compile error: '+a.getShaderInfoLog(b));return b}if(b={},b.id=a.createProgram(),a.attachShader(b.id,g(a.VERTEX_SHADER,h)),a.attachShader(b.id,g(a.FRAGMENT_SHADER,e)),a.linkProgram(b.id),!a.getProgramParameter(b.id,a.LINK_STATUS))throw new Error('link error: '+a.getProgramInfoLog(b.id));for(b.uniforms={},b.locations={},a.useProgram(b.id),a.enableVertexAttribArray(0),i=/uniform (\w+) (\w+)/g,f=h+e;(d=i.exec(f))!=null;)c=d[2],b.locations[c]=a.getUniformLocation(b.id,c);return b}function f(b,c){a.activeTexture(a.TEXTURE0+(c||0)),a.bindTexture(a.TEXTURE_2D,b)}function i(b){var a=/url\(["']?([^"']*)["']?\)/.exec(b);return a==null?null:a[1]}function k(a){return a.match(/^data:/)}d=l(),m=j(32,32),b('head').prepend('<style>.jquery-ripples { position: relative; z-index: 0; }</style>'),c=function(k,e){var f=this,c,i,h,g;this.$el=b(k),this.interactive=e.interactive,this.resolution=e.resolution,this.textureDelta=new Float32Array([1/this.resolution,1/this.resolution]),this.perturbance=e.perturbance,this.dropRadius=e.dropRadius,this.crossOrigin=e.crossOrigin,this.imageUrl=e.imageUrl,c=document.createElement('canvas'),c.width=this.$el.innerWidth(),c.height=this.$el.innerHeight(),this.canvas=c,this.$canvas=b(c),this.$canvas.css({position:'absolute',left:0,top:0,right:0,bottom:0,zIndex:-1}),this.$el.addClass('jquery-ripples').append(c),this.context=a=c.getContext('webgl')||c.getContext('experimental-webgl'),d.extensions.forEach(function(b){a.getExtension(b)}),b(window).on('resize',function(){var a=f.$el.innerWidth(),b=f.$el.innerHeight();(a!=f.canvas.width||b!=f.canvas.height)&&(c.width=a,c.height=b)}),this.textures=[],this.framebuffers=[],this.bufferWriteIndex=0,this.bufferReadIndex=1;for(i=0;i<2;i++)h=a.createTexture(),g=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,g),g.width=this.resolution,g.height=this.resolution,a.bindTexture(a.TEXTURE_2D,h),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d.linearSupport?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d.linearSupport?a.LINEAR:a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.resolution,this.resolution,0,a.RGBA,d.type,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,h,0),this.textures.push(h),this.framebuffers.push(g);this.quad=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.quad),a.bufferData(a.ARRAY_BUFFER,new Float32Array([-1,-1,+1,-1,+1,+1,-1,+1]),a.STATIC_DRAW),this.initShaders(),this.initTexture(),this.setTransparentTexture(),this.loadImage(),a.clearColor(0,0,0,0),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),this.visible=!0,this.running=!0,this.inited=!0,this.setupPointerEvents();function j(){f.step(),requestAnimationFrame(j)}requestAnimationFrame(j)},c.DEFAULTS={imageUrl:null,resolution:256,dropRadius:20,perturbance:.03,interactive:!0,crossOrigin:''},c.prototype={setupPointerEvents:function(){var a=this;function c(){return a.visible&&a.running&&a.interactive}function b(d,b){c()&&a.dropAtPointer(d,a.dropRadius*(b?1.5:1),b?.14:.01)}this.$el.on('mousemove.ripples',function(a){b(a)}).on('touchmove.ripples, touchstart.ripples',function(d){for(var c=d.originalEvent.changedTouches,a=0;a<c.length;a++)b(c[a])}).on('mousedown.ripples',function(a){b(a,!0)})},loadImage:function(){var c=this,d,b;if(a=this.context,d=this.imageUrl||i(this.originalCssBackgroundImage)||i(this.$el.css('backgroundImage')),d==this.imageSource)return;if(this.imageSource=d,!this.imageSource){this.setTransparentTexture();return}b=new Image,b.onload=function(){a=c.context;function d(a){return(a&a-1)==0}var e=d(b.width)&&d(b.height)?a.REPEAT:a.CLAMP_TO_EDGE;a.bindTexture(a.TEXTURE_2D,c.backgroundTexture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,e),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,b),c.backgroundWidth=b.width,c.backgroundHeight=b.height,c.hideCssBackground()},b.onerror=function(){a=c.context,c.setTransparentTexture()},b.crossOrigin=k(this.imageSource)?null:this.crossOrigin,b.src=this.imageSource},step:function(){if(a=this.context,!this.visible)return;this.computeTextureBoundaries(),this.running&&this.update(),this.render()},drawQuad:function(){a.bindBuffer(a.ARRAY_BUFFER,this.quad),a.vertexAttribPointer(0,2,a.FLOAT,!1,0,0),a.drawArrays(a.TRIANGLE_FAN,0,4)},render:function(){a.bindFramebuffer(a.FRAMEBUFFER,null),a.viewport(0,0,this.canvas.width,this.canvas.height),a.enable(a.BLEND),a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT),a.useProgram(this.renderProgram.id),f(this.backgroundTexture,0),f(this.textures[0],1),a.uniform1f(this.renderProgram.locations.perturbance,this.perturbance),a.uniform2fv(this.renderProgram.locations.topLeft,this.renderProgram.uniforms.topLeft),a.uniform2fv(this.renderProgram.locations.bottomRight,this.renderProgram.uniforms.bottomRight),a.uniform2fv(this.renderProgram.locations.containerRatio,this.renderProgram.uniforms.containerRatio),a.uniform1i(this.renderProgram.locations.samplerBackground,0),a.uniform1i(this.renderProgram.locations.samplerRipples,1),this.drawQuad(),a.disable(a.BLEND)},update:function(){a.viewport(0,0,this.resolution,this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),f(this.textures[this.bufferReadIndex]),a.useProgram(this.updateProgram.id),this.drawQuad(),this.swapBufferIndices()},swapBufferIndices:function(){this.bufferWriteIndex=1-this.bufferWriteIndex,this.bufferReadIndex=1-this.bufferReadIndex},computeTextureBoundaries:function(){var g=this.$el.css('background-size'),m=this.$el.css('background-attachment'),j=n(this.$el.css('background-position')),a,i,b,c,d,f,k,l;m=='fixed'?(a={left:window.pageXOffset,top:window.pageYOffset},a.width=h.width(),a.height=h.height()):(a=this.$el.offset(),a.width=this.$el.innerWidth(),a.height=this.$el.innerHeight()),g=='cover'?(i=Math.max(a.width/this.backgroundWidth,a.height/this.backgroundHeight),b=this.backgroundWidth*i,c=this.backgroundHeight*i):g=='contain'?(i=Math.min(a.width/this.backgroundWidth,a.height/this.backgroundHeight),b=this.backgroundWidth*i,c=this.backgroundHeight*i):(g=g.split(' '),b=g[0]||'',c=g[1]||b,e(b)?b=a.width*parseFloat(b)/100:b!='auto'&&(b=parseFloat(b)),e(c)?c=a.height*parseFloat(c)/100:c!='auto'&&(c=parseFloat(c)),b=='auto'&&c=='auto'?(b=this.backgroundWidth,c=this.backgroundHeight):(b=='auto'&&(b=this.backgroundWidth*(c/this.backgroundHeight)),c=='auto'&&(c=this.backgroundHeight*(b/this.backgroundWidth)))),d=j[0],f=j[1],e(d)?d=a.left+(a.width-b)*parseFloat(d)/100:d=a.left+parseFloat(d),e(f)?f=a.top+(a.height-c)*parseFloat(f)/100:f=a.top+parseFloat(f),k=this.$el.offset(),this.renderProgram.uniforms.topLeft=new Float32Array([(k.left-d)/b,(k.top-f)/c]),this.renderProgram.uniforms.bottomRight=new Float32Array([this.renderProgram.uniforms.topLeft[0]+this.$el.innerWidth()/b,this.renderProgram.uniforms.topLeft[1]+this.$el.innerHeight()/c]),l=Math.max(this.canvas.width,this.canvas.height),this.renderProgram.uniforms.containerRatio=new Float32Array([this.canvas.width/l,this.canvas.height/l])},initShaders:function(){var b=['attribute vec2 vertex;','varying vec2 coord;','void main() {','coord = vertex * 0.5 + 0.5;','gl_Position = vec4(vertex, 0.0, 1.0);','}'].join('\n');this.dropProgram=g(b,['precision highp float;','const float PI = 3.141592653589793;','uniform sampler2D texture;','uniform vec2 center;','uniform float radius;','uniform float strength;','varying vec2 coord;','void main() {','vec4 info = texture2D(texture, coord);','float drop = max(0.0, 1.0 - length(center * 0.5 + 0.5 - coord) / radius);','drop = 0.5 - cos(drop * PI) * 0.5;','info.r += drop * strength;','gl_FragColor = info;','}'].join('\n')),this.updateProgram=g(b,['precision highp float;','uniform sampler2D texture;','uniform vec2 delta;','varying vec2 coord;','void main() {','vec4 info = texture2D(texture, coord);','vec2 dx = vec2(delta.x, 0.0);','vec2 dy = vec2(0.0, delta.y);','float average = (','texture2D(texture, coord - dx).r +','texture2D(texture, coord - dy).r +','texture2D(texture, coord + dx).r +','texture2D(texture, coord + dy).r',') * 0.25;','info.g += (average - info.r) * 2.0;','info.g *= 0.995;','info.r += info.g;','gl_FragColor = info;','}'].join('\n')),a.uniform2fv(this.updateProgram.locations.delta,this.textureDelta),this.renderProgram=g(['precision highp float;','attribute vec2 vertex;','uniform vec2 topLeft;','uniform vec2 bottomRight;','uniform vec2 containerRatio;','varying vec2 ripplesCoord;','varying vec2 backgroundCoord;','void main() {','backgroundCoord = mix(topLeft, bottomRight, vertex * 0.5 + 0.5);','backgroundCoord.y = 1.0 - backgroundCoord.y;','ripplesCoord = vec2(vertex.x, -vertex.y) * containerRatio * 0.5 + 0.5;','gl_Position = vec4(vertex.x, -vertex.y, 0.0, 1.0);','}'].join('\n'),['precision highp float;','uniform sampler2D samplerBackground;','uniform sampler2D samplerRipples;','uniform vec2 delta;','uniform float perturbance;','varying vec2 ripplesCoord;','varying vec2 backgroundCoord;','void main() {','float height = texture2D(samplerRipples, ripplesCoord).r;','float heightX = texture2D(samplerRipples, vec2(ripplesCoord.x + delta.x, ripplesCoord.y)).r;','float heightY = texture2D(samplerRipples, vec2(ripplesCoord.x, ripplesCoord.y + delta.y)).r;','vec3 dx = vec3(delta.x, heightX - height, 0.0);','vec3 dy = vec3(0.0, heightY - height, delta.y);','vec2 offset = -normalize(cross(dy, dx)).xz;','float specular = pow(max(0.0, dot(offset, normalize(vec2(-0.6, 1.0)))), 4.0);','gl_FragColor = texture2D(samplerBackground, backgroundCoord + offset * perturbance) + specular;','}'].join('\n')),a.uniform2fv(this.renderProgram.locations.delta,this.textureDelta)},initTexture:function(){this.backgroundTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.backgroundTexture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,1),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR)},setTransparentTexture:function(){a.bindTexture(a.TEXTURE_2D,this.backgroundTexture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,m)},hideCssBackground:function(){var a=this.$el[0].style.backgroundImage;if(a=='none')return;this.originalInlineCss=a,this.originalCssBackgroundImage=this.$el.css('backgroundImage'),this.$el.css('backgroundImage','none')},restoreCssBackground:function(){this.$el.css('backgroundImage',this.originalInlineCss||'')},dropAtPointer:function(a,b,c){var d=parseInt(this.$el.css('border-left-width'))||0,e=parseInt(this.$el.css('border-top-width'))||0;this.drop(a.pageX-this.$el.offset().left-d,a.pageY-this.$el.offset().top-e,b,c)},drop:function(i,j,c,h){var d,e,b,g;a=this.context,d=this.$el.innerWidth(),e=this.$el.innerHeight(),b=Math.max(d,e),c=c/b,g=new Float32Array([(2*i-d)/b,(e-2*j)/b]),a.viewport(0,0,this.resolution,this.resolution),a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffers[this.bufferWriteIndex]),f(this.textures[this.bufferReadIndex]),a.useProgram(this.dropProgram.id),a.uniform2fv(this.dropProgram.locations.center,g),a.uniform1f(this.dropProgram.locations.radius,c),a.uniform1f(this.dropProgram.locations.strength,h),this.drawQuad(),this.swapBufferIndices()},destroy:function(){this.$el.off('.ripples').removeClass('jquery-ripples').removeData('ripples'),this.$canvas.remove(),this.restoreCssBackground()},show:function(){this.visible=!0,this.$canvas.show(),this.hideCssBackground()},hide:function(){this.visible=!1,this.$canvas.hide(),this.restoreCssBackground()},pause:function(){this.running=!1},play:function(){this.running=!0},set:function(a,b){switch(a){case'dropRadius':case'perturbance':case'interactive':case'crossOrigin':this[a]=b;break;case'imageUrl':this.imageUrl=b,this.loadImage();break}}},o=b.fn.ripples,b.fn.ripples=function(a){if(!d)throw new Error('Your browser does not support WebGL, the OES_texture_float extension or rendering to floating point textures.');var e=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var f=b(this),d=f.data('ripples'),g=b.extend({},c.DEFAULTS,f.data(),typeof a=='object'&&a);if(!d&&typeof a=='string')return;d?typeof a=='string'&&c.prototype[a].apply(d,e):f.data('ripples',d=new c(this,g))})},b.fn.ripples.Constructor=c,b.fn.ripples.noConflict=function(){return b.fn.ripples=o,this}})